# Auto generated by Edalize
NAME := {{ name }}
OPTIONS := {{ tool_options.quartus_options|join(' ') }}
HDL_SOURCE_FILES := {{ hdl_source_files }}
QSYS_SOURCE_FILES := {{ qsys_source_files }}
TB_FILES := {{ tb_files }}
ASSIGNMENT_FILES := $(NAME).qpf $(NAME).qsf

all: sta

$(NAME).qpf: $(NAME).tcl
	quartus_sh $(OPTIONS) -t $(NAME).tcl

qsys.done: $(NAME).qpf $(QSYS_SOURCE_FILES)
{% for qsys_file in src_files if qsys_file|qsys_file_filter %}
	ip-generate --project-directory={{qsys_file.srcdir}} --output-directory={{qsys_file.dstdir}} --report-file=bsf:{{qsys_file.dstdir}}/{{qsys_file.simplename}}.bsf --system-info=DEVICE_FAMILY="{{tool_options.family}}" --system-info=DEVICE={{tool_options.device}} --component-file={{qsys_file.srcdir}}/{{qsys_file.name}}
	ip-generate --project-directory={{qsys_file.srcdir}} --output-directory={{qsys_file.dstdir}}/synthesis --file-set=QUARTUS_SYNTH --report-file=sopcinfo:{{qsys_file.dstdir}}/{{qsys_file.simplename}}.sopcinfo --report-file=html:{{qsys_file.dstdir}}/{{qsys_file.simplename}}.html --report-file=qip:{{qsys_file.dstdir}}/{{qsys_file.simplename}}.qip --report-file=cmp:{{qsys_file.dstdir}}/{{qsys_file.simplename}}.cmp --report-file=svd --system-info=DEVICE_FAMILY="{{tool_options.family}}" --system-info=DEVICE={{tool_options.device}} --component-file={{qsys_file.srcdir}}/{{qsys_file.simplename}}.qsys --language=VERILOG{% endfor %}
	touch qsys.done

project: $(NAME).qpf
map: smart.log $(NAME).map.rpt
fit: smart.log $(NAME).fit.rpt
asm: smart.log $(NAME).asm.rpt
sta: smart.log $(NAME).sta.rpt
eda: smart.log $(NAME).eda.rpt

$(NAME).map.rpt: map.chg qsys.done $(HDL_SOURCE_FILES)
	quartus_map $(OPTIONS) $(NAME)
	
fit.chg:
	touch fit.chg
	
eda.chg:
	touch eda.chg
	
asm.chg:
	touch asm.chg
	
sta.chg:
	touch sta.chg

$(NAME).fit.rpt: fit.chg $(NAME).map.rpt
	quartus_fit $(OPTIONS) $(NAME)

$(NAME).asm.rpt: asm.chg $(NAME).fit.rpt
	quartus_asm $(OPTIONS) $(NAME)

$(NAME).sta.rpt: sta.chg $(NAME).asm.rpt
	quartus_sta $(OPTIONS) $(NAME)

$(NAME).eda.rpt: eda.chg $(NAME).fit.rpt
	quartus_eda --simulation --tool=modelsim_oem --format=verilog $(OPTIONS) $(NAME)

clean:
	rm -rf *.* db incremental_db
	
sim_netlist: $(NAME).fit.rpt $(TB_FILES)
	vsim -do sim_netlist.do
	
smart.log: $(ASSIGNMENT_FILES)
	quartus_sh --determine_smart_action $(NAME) > smart.log
