# Auto generated by Edalize
NAME := {{ name }}
OPTIONS := {{ tool_options.quartus_options|join(' ') }}
HDL_SOURCE_FILES := {{ hdl_source_files }}
QSYS_SOURCE_FILES := {{ qsys_source_files }}
ASSIGNMENT_FILES := $(NAME).qpf $(NAME).qsf

all: sta

$(NAME).qpf: $(NAME).tcl
	quartus_sh $(OPTIONS) -t $(NAME).tcl

qsys.done: $(NAME).qpf ${QSYS_SOURCE_FILES){% for qsys_file in src_files if qsys_file|qsys_file_filter %}
	qsys-generate {{ qsys_file|qsys_file_filter }} --synthesis=VERILOG --family="{{ tool_options.family }}" --part={{ tool_options.device }} --quartus-project=$(NAME){% endfor %}
	touch qsys.done

qsys: qsys.chg
map: smart.log $(NAME).syn.rpt
fit: smart.log $(NAME).fit.rpt
asm: smart.log $(NAME).asm.rpt
sta: smart.log $(NAME).sta.rpt
eda: smart.log $(NAME).eda.rpt

$(NAME).syn.rpt: syn.chg qsys.done $(HDL_SOURCE_FILES)
	quartus_map $(OPTIONS) $(NAME)
	
fit.chg:
	touch fit.chg
	
eda.chg:
	touch eda.chg
	
asm.chg:
	touch asm.chg
	
sta.chg:
	touch sta.chg

$(NAME).fit.rpt: fit.chg map
	quartus_fit $(OPTIONS) $(NAME)

$(NAME).asm.rpt: asm.chg fit
	quartus_asm $(OPTIONS) $(NAME)

$(NAME).sta.rpt: sta.chg asm
	quartus_sta $(OPTIONS) $(NAME)

$(NAME).eda.rpt: eda.chg fit
	quartus_eda --simulation -tool=modelsim_oem --format=verilog $(OPTIONS) $(NAME)

clean:
	rm -rf *.* qdb tmp-clearbox

smart.log: $(ASSIGNMENT_FILES) project
	quartus_sh --determine_smart_action $(NAME) > smart.log
